<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Champs joyeux</title>

<style>
    body {
        font-family: 'Arial', sans-serif;
        background: #f0f4ff;
        margin: 0;
        display: flex;
        height: 100vh;
        justify-content: center;
        align-items: center;
        transition: background 0.4s;
    }

    body.night {
        background: #0b0f1a;
        color: white;
    }

    .container {
        width: 850px;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.25);
        background: white;
        transition: background 0.4s, color 0.4s;
    }

    body.night .container {
        background: #1b2338;
        color: #fff;
    }

    h1 {
        margin-top: 0;
        text-align: center;
    }

    #display {
        background: rgba(180,190,255,0.3);
        border-left: 5px solid #6a82ff;
        min-height: 160px;
        padding: 20px;
        font-size: 1.3em;
        line-height: 1.7em;
        border-radius: 8px;
        overflow-y: auto;
    }

    .word {
        opacity: 0.35;
        padding: 2px 4px;
        transition: 0.12s;
    }

    .word.active {
        background: yellow;
        color: black;
        opacity: 1;
        border-radius: 4px;
        font-weight: bold;
    }

    .controls button {
        padding: 10px 20px;
        margin: 6px;
        border: none;
        background: #5678ff;
        color: white;
        border-radius: 8px;
        cursor: pointer;
        transition: 0.3s;
    }

    .controls button:hover {
        background: #2a4fff;
    }

    .row {
        margin-top: 15px;
    }

    #visualizer {
        width: 100%;
        height: 80px;
        background: #000;
        margin-top: 25px;
        border-radius: 10px;
    }
</style>
</head>
<body>

<div class="container">
    <h1>Chants joyeux</h1>

    <label>Voix : 
        <select id="voiceSelect"></select>
    </label>

    <label style="margin-left:15px;">
        Vitesse : <input type="range" id="rateSlider" min="0.5" max="1.5" value="1" step="0.1">
    </label>

    <label style="margin-left:15px;">
        Mode nuit : <input type="checkbox" id="nightMode">
    </label>

    <div id="display">Choisis un chant‚Ä¶</div>

    <div class="row">
        <button onclick="startSong('joie')">üéµ Chant de la joie</button>
        <button onclick="startSong('lumiere')">‚ú® Lumi√®re divine</button>
        <button onclick="startSong('paix')">üïäÔ∏è Chant de paix</button>
    </div>

    <div class="controls row">
        <button onclick="pauseKaraoke()">‚è∏ Pause</button>
        <button onclick="resumeKaraoke()">‚ñ∂ Reprendre</button>
        <button onclick="stopKaraoke()">‚èπ Stop</button>
    </div>

    <canvas id="visualizer"></canvas>
</div>


<script>
/* ---------------------- MUSIQUE ------------------------ */

const music = new Audio("https://cdn.pixabay.com/download/audio/2023/03/14/audio_6b0e3b31e2.mp3?filename=soft-ambient-140253.mp3");
music.loop = true;
music.volume = 0.5;

/* ---------------------- TEXTES ------------------------ */

const songs = {
    joie: "Chante la vie, chante l‚Äôespoir, laisse ton c≈ìur s‚Äôouvrir au soir, que la lumi√®re en toi s‚Äô√©l√®ve, comme un doux chant qui te soul√®ve.",
    lumiere: "La lumi√®re brille dans la nuit, guidant nos pas sans faire de bruit, elle √©claire notre chemin, et nous prot√®ge jusqu‚Äôau matin.",
    paix: "Dans le souffle calme du vent, la paix descend doucement, elle enveloppe tous les √™tres, et fait na√Ætre un monde √† rena√Ætre."
};

/* ---------------------- KARAOKE MOT PAR MOT ------------------------ */

let currentWords = [];
let index = 0;
let interval = null;

function startSong(key) {
    stopKaraoke();

    const text = songs[key];
    const display = document.getElementById("display");

    display.innerHTML = "";
    currentWords = text.split(" ");

    currentWords.forEach(w => {
        const span = document.createElement("span");
        span.className = "word";
        span.textContent = w + " ";
        display.appendChild(span);
    });

    const elements = document.querySelectorAll(".word");

    index = 0;
    music.play();

    function highlight() {
        if (index >= elements.length) return;

        elements.forEach(el => el.classList.remove("active"));
        elements[index].classList.add("active");

        speakWord(elements[index].textContent);

        index++;
    }

    interval = setInterval(highlight, 420);
}

/* ---------------------- VOIX & PAROLE ------------------------ */

const voiceSelect = document.getElementById("voiceSelect");
let voices = [];

function loadVoices() {
    voices = speechSynthesis.getVoices();
    voiceSelect.innerHTML = "";

    voices.forEach(v => {
        const opt = document.createElement("option");
        opt.textContent = v.name + " (" + v.lang + ")";
        voiceSelect.appendChild(opt);
    });
}
speechSynthesis.onvoiceschanged = loadVoices;

function speakWord(word) {
    const u = new SpeechSynthesisUtterance(word);
    u.voice = voices[voiceSelect.selectedIndex];
    u.rate = document.getElementById("rateSlider").value;
    speechSynthesis.speak(u);
}

/* ---------------------- CONTROLES ------------------------ */

function pauseKaraoke() {
    music.pause();
    speechSynthesis.pause();
}

function resumeKaraoke() {
    music.play();
    speechSynthesis.resume();
}

function stopKaraoke() {
    music.pause();
    music.currentTime = 0;
    speechSynthesis.cancel();
    clearInterval(interval);
}

/* ---------------------- MODE NUIT ------------------------ */

document.getElementById("nightMode").addEventListener("change", e => {
    document.body.classList.toggle("night", e.target.checked);
});

/* ---------------------- VISUALISEUR AUDIO ------------------------ */

const canvas = document.getElementById("visualizer");
const ctx = canvas.getContext("2d");

let audioCtx = new (window.AudioContext || window.webkitAudioContext)();
let analyser = audioCtx.createAnalyser();
let src = audioCtx.createMediaElementSource(music);

src.connect(analyser);
analyser.connect(audioCtx.destination);
analyser.fftSize = 256;

function draw() {
    requestAnimationFrame(draw);

    let data = new Uint8Array(analyser.frequencyBinCount);
    analyser.getByteFrequencyData(data);

    ctx.fillStyle = "black";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    let barWidth = canvas.width / data.length;
    for (let i = 0; i < data.length; i++) {
        const h = data[i];
        ctx.fillStyle = `rgb(${h+40}, ${h}, 255)`;
        ctx.fillRect(i * barWidth, canvas.height - h, barWidth, h);
    }
}
draw();
</script>

</body>
</html>
