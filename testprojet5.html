<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chants joyeux</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #eaf0ff;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
}
.container {
    background: white;
    padding: 30px;
    border-radius: 15px;
    max-width: 700px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    text-align: center;
}
.text-box {
    background: #eef;
    border-left: 4px solid #77f;
    padding: 20px;
    margin: 20px 0;
    min-height: 150px;
    max-height: 300px;
    overflow-y: auto;
}
.karaoke-line {
    opacity: 0.4;
    transition: .3s;
    padding: 4px;
}
.active-line {
    background: yellow;
    opacity: 1 !important;
    font-weight: bold;
}
button {
    padding: 12px 25px;
    margin: 5px;
    border: none;
    border-radius: 8px;
    font-size: 1em;
    background: #448aff;
    color: white;
    cursor: pointer;
}
button:hover {
    background: #2962ff;
}
</style>
</head>
<body>

<div class="container">
    <h1>Chants joyeux</h1>

    <div id="textDisplay" class="text-box">
        Cliquez sur un chant pour commencer.
    </div>

    <div id="buttonsContainer"></div>

    <div class="buttons">
        <button onclick="pauseAll()">Pause</button>
        <button onclick="resumeAll()">Reprendre</button>
        <button onclick="stopAll()">Stop</button>
    </div>
</div>

<script>
/* ðŸŽµ MUSIQUE 100% LIBRE DE DROITS */
const music = new Audio("https://cdn.pixabay.com/download/audio/2023/03/02/audio_8c00b6fe26.mp3?filename=gentle-piano-hymn-142090.mp3");
music.preload = "auto";
music.loop = true;
music.volume = 1;

/* ðŸ“œ TEXTES */
const texts = {
    grandDieu: [
        "Grand Dieu puissant, nous cÃ©lÃ©brons",
        "Ta gloire auguste et ta justice ;",
        "Devant ton trÃ´ne nous chantons,",
        "RachetÃ©s par ton sacrifice."
    ],
    appelez: [
        "Le temps sâ€™enfuit, le Sauveur vous appelle,",
        "PÃ©cheurs, venez, rÃ©pondez Ã  sa voix :",
        "Pour recevoir la couronne immortelle,",
        "Que JÃ©sus donne Ã  toute Ã¢me qui croit."
    ],
    jesus: [
        "JÃ©sus, doux MaÃ®tre,",
        "RÃ¨gne sur moi,",
        "Soumets mon Ãªtre,",
        "Sois-en le Roi."
    ]
};

/* ðŸ”˜ CRÃ‰ATION DES BOUTONS */
const btns = document.getElementById("buttonsContainer");
for (let key in texts) {
    let b = document.createElement("button");
    b.textContent = key;
    b.onclick = () => startSong(key);  // musique + voix dans le mÃªme clic
    btns.appendChild(b);
}

let timeouts = [];

/* ðŸŽ¤ LECTURE + MUSIQUE (fonctionne sur tÃ©lÃ©phone) */
function startSong(key) {

    stopAll(); // reset

    // ðŸ‘‰ OBLIGATOIRE : lancer la musique sur *le mÃªme clic*
    music.play().catch(() => {
        alert("Touchez lâ€™Ã©cran encore une fois pour autoriser la musique !");
    });

    const display = document.getElementById("textDisplay");
    display.innerHTML = "";

    const lines = texts[key];

    lines.forEach(l => {
        const p = document.createElement("p");
        p.className = "karaoke-line";
        p.textContent = l;
        display.appendChild(p);
    });

    const elems = document.querySelectorAll(".karaoke-line");

    let i = 0;

    function nextLine() {
        if (i >= lines.length) return;

        elems.forEach(e => e.classList.remove("active-line"));
        elems[i].classList.add("active-line");

        const say = new SpeechSynthesisUtterance(lines[i]);
        say.lang = "fr-FR";
        say.pitch = 1.1;
        say.rate = 0.9;
        speechSynthesis.speak(say);

        i++;
        timeouts.push(setTimeout(nextLine, 2400));
    }

    nextLine();
}

/* CONTROLES */
function pauseAll() {
    speechSynthesis.pause();
    music.pause();
}
function resumeAll() {
    speechSynthesis.resume();
    music.play();
}
function stopAll() {
    speechSynthesis.cancel();
    music.pause();
    music.currentTime = 0;

    timeouts.forEach(t => clearTimeout(t));
    timeouts = [];
}
</script>
</body>
</html>
